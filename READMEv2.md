### Indexed tests created with Supertest, Mocha, Chai and Typescript with in-built BDD assertions. 

- Background: These tests were created in line with the previous Postman collection I delivered, containing identical indexing with some minor additions. I followed the previous end2end style of arranging the tests spreading flows across multiple test files, using Chai 'expect' for assertions, these tests could be modified to utilise an afterEach cleanup hook with end2end tests contained inside a single test class. Also I mostly focussed on positive tests, negative testing would be very straightforward to implement using this approach. Supertest is a Super-agent driven library for testing node.js HTTP servers using a fluent API.

1. Install steps:
	1. Install node.js
	2. create new folder for tests to reside
	3. ensure you copy following files from github repo: 'tsconfig.json' + /tests folder into root of newly created folder
	4. From command line ensure you run 'npm init -y' inside newly created folder
	5. From command line run 'npm install supertest mocha chai --save-dev' inside newly created folder
	6. From command line run 'npm i --save-dev @types/mocha' inside newly created folder
	7. From command line run 'npm i --save-dev @types/node' inside newly created folder
	
2. Test details: 
	- Tests contain 58 indexed test files
	- 1 helper class
	- 2 .txt files (for writing tokens to, deprecated)
	
3. Switching from dev to prod env:
	- In helper class comment/uncomment baseUrl and clientId to desired corresponding environment inside method.exports. 
	```
	dev environment on/prod off:
	module.exports = {
		   baseUrl: {
			//dev
			"url": "https://kq5xvr42bi.execute-api.us-east-1.amazonaws.com/test-qa-judeshiels-dev",
			//prod
			//"url": "https://dudq8wv4c5.execute-api.us-east-1.amazonaws.com/test-qa-judeshiels-prod",
		    },
		    clientId: {
			//dev
			"id": "q69csigu8dnp4106sdokq0l6n",
			//prod
			//"id": "4p57q2erkqvv515r41hls93lor",
		    }
	    }
	    
	  prod on/dev off  
	  module.exports = {
		     baseUrl: {
			//dev
			//"url": "https://kq5xvr42bi.execute-api.us-east-1.amazonaws.com/test-qa-judeshiels-dev",
			//prod
			"url": "https://dudq8wv4c5.execute-api.us-east-1.amazonaws.com/test-qa-judeshiels-prod",
		    },
		    clientId: {
			//dev
			//"id": "q69csigu8dnp4106sdokq0l6n",
			//prod
			"id": "4p57q2erkqvv515r41hls93lor",
		    }
	    }
4. To run test scripts:
	- cd to tests folder
	- From command line or IDE terminal run npx mocha *.ts
		
5. Expected results on dev:
	- 104 passing
  	- 4 failing
	- expected failing tests: 15.1, 14.4, 14.3, 14.2 
	
6. Expected results on prod:
	- 92 passing
  	- 16 failing
	- expected failing tests as above plus photoUrl issue which does not occur same as on dev, impacted: 10.1 x 3, 9.3, 9.2, 9.1 , 7.1 x 3, 6.3, 6.2, 6.1.
	
7. Meeting acceptance criteria

##### The acceptance criteria that the API must meet are the following:

	• A user can:
	
	◦ List all customers in the database. ↓
	 REF: 7. Query/CustomerReadModels/onCreate

	◦ Get full customer information, including a photo URL. ↓
	 REF: 6. Queries/CustomerReadModel/onCreate & 7. Query/CustomerReadModels/onCreate 

	◦ Create a new customer:  ↓
	 REF: 5. Mutations/SaveCustomer/Create

	▪ A customer should have (an asterisk indicates that it is a required field): ↓

	 REF: 6. Queries/CustomerReadModel/onCreate & 7. Query/CustomerReadModels/onCreate 
	▪ * name,
	▪ * surname,
	▪ * id (autogenerated),
	▪ photoUrl ↓
	 REF: 18.4 & 18.5 & 18.6
	▪ * userId
  
	▪ Image uploads should be able to be managed. ↓
	 REF: 5. Mutations/SaveCustomer/Create

	▪ The customer should have a reference to the user who created it.  ↓
	 REF: 5. Mutations/SaveCustomer/Create & 18. Add customer with newly created Admin end2end workflow

	◦ Update an existing customer. ↓
	 REF: 9. Queries/CustomerReadModel/onUpdate & 10. Query/CustomerReadModels/onUpdate

	▪ The customer should hold a reference to the last user who modified it.  ↓
	 REF: 9. Queries/CustomerReadModel/onUpdate & 10. Query/CustomerReadModels/onUpdate 
	 & 18.5 query/CustomerReadModel get customerId:4 data

	◦ Delete an existing customer. ↓
	 REF: 11. Mutations/DeleteCustomer/Delete

	• An admin can also:   
	
	◦ Manage users:
	▪ Create users. ↓
	 REF: 2. Mutations/Create/SaveUser
	▪ Delete users.  ↓
	 REF: 16. Mutations/UserReadModel/Delete
	▪ Update users. ↓
	 REF: 14. ChangeUserRole/Tests & see Issues Noted below
	▪ List users.   ↓
	 REF: 3. Queries/UserReadModel/onCreate & 4. Query/UserReadModels/onCreate
	▪ Change admin status.   ↓
	 REF: 14. ChangeUserRole/Tests
	 
	 
8. Issues noted: 
	
	1. photoUrl key is not accepted inside SaveCustomer mutation, photo is accepted.
	 REF 5.1, 5.2, 5.3, 6.1, 6.2, 6.3

	2. On prod for query CustomerReadModel an empty value is returned for photo/photoUrl, 
	on dev "test-qa-judeshiels-dev-app/1/photo.jpg" or variant is returned. 
	 REF: 6.1, 6.2, 6.3

	3. When running UserReadModel on user with an updated role Admin->User, null result is returned.
	It appears ChangeUserRole does not support validation. I can enter any text into role field 
	and it will return 'True' for ChangeUserRole inside the response body. 
	 REF: 14.2, 14.3, 14.4, 14.5

	4. Username is used on mutation 'SaveUser' , id is used on queries inside 'UserReadModel', 
	schema makes no reference to username, should the mutations tab list required arguments also?
	 REF: 2.1, 3.1

	5. I can in theory update user role using ChangeUserRole, but not id/username or password through SaveUser? 
	SaveUser requires unique email each time effectively creating a new user entry, not updating details of existing user. 
	I mention it because this is not consistent with SaveCustomer behaviour which will update customer through recognising customer id.
	 REF: 14.2, 15,1, 15,2

	6. id should be displayed in CustomerReadModel/CustomerReadModels response body same as userId?
	 REF: 6.1, 7.1

	7. Ordering is not implemented inside schema, this means using Postman tests I needed to descope tests 
	or modify test assertions to be less specific.
